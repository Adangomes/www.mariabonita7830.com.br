<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MYDI DELIVERY</title>

  <meta name="theme-color" content="#dc2626"/>
  <link rel="manifest" href="manifest.json?v=3">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { -webkit-tap-highlight-color: transparent; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

    /* Setas de rolagem das categorias */
    .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.8);
      border-radius: 9999px;
      padding: 2px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }
    .arrow:hover { background: rgba(255,255,255,1); }
  </style>
</head>

<body class="bg-gray-50 text-gray-900 font-sans antialiased">
  <div id="root"></div>

  <!-- React App -->
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const parceiros = [
      { id: 1, nome: "SNOOP LANCHE", url: "https://snooplanche2.netlify.app/", img: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=400", tipo: "LANCHES", promo: true },
      { id: 3, nome: "KINGS BURGER", url: "https://kingsburger.netlify.app/", img: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=400", tipo: "LANCHES", promo: false },
      { id: 2, nome: "SUSHI", url: "", img: "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=400", tipo: "JAPONESA", promo: false },
      { id: 4, nome: "PIZZA HOUSE", url: "", img: "https://images.unsplash.com/photo-1600891964599-f61ba0e24092?w=400", tipo: "PIZZAS", promo: true }
    ];

    function App() {
      const [filtro, setFiltro] = useState(null);
      const [deferredPrompt, setDeferredPrompt] = useState(null);
      const categorias = ["PROMOÇÕES", "LANCHES", "JAPONESA", "PIZZAS"];
      const filtrados = filtro === "PROMOÇÕES" 
          ? parceiros.filter(p => p.promo) 
          : filtro 
              ? parceiros.filter(p => p.tipo === filtro) 
              : parceiros;

      const catRef = useRef(null);
      const [canScrollLeft, setCanScrollLeft] = useState(false);
      const [canScrollRight, setCanScrollRight] = useState(false);

      // Checa se pode rolar as categorias
      const checkScroll = () => {
        const el = catRef.current;
        if (!el) return;
        setCanScrollLeft(el.scrollLeft > 0);
        setCanScrollRight(el.scrollLeft + el.clientWidth < el.scrollWidth);
      };

      useEffect(() => {
        const beforeInstall = (e) => { e.preventDefault(); setDeferredPrompt(e); };
        window.addEventListener("beforeinstallprompt", beforeInstall);
        window.addEventListener("resize", checkScroll);
        return () => { 
          window.removeEventListener("beforeinstallprompt", beforeInstall);
          window.removeEventListener("resize", checkScroll);
        };
      }, []);

      const instalarApp = () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then(() => setDeferredPrompt(null));
        } else {
          alert("Aguarde um momento... Se estiver no iPhone, use 'Adicionar à Tela de Início'.");
        }
      };

      const scrollCategorias = (dir) => {
        catRef.current.scrollBy({ left: dir * 100, behavior: 'smooth' });
      };

      return (
        <div className="flex flex-col min-h-screen pb-10 relative">
          {/* Header */}
          <header className="bg-red-600 px-6 py-4 flex flex-col items-center shadow-sm">
            <h1 className="text-red-100 text-[30px] font-bold">MYDI DELIVERY</h1>
            <span className="text-red-100 text-[10px] font-bold uppercase tracking-[2px] mt-1 px-2 py-0.5 bg-red-700 rounded-full">Pediu, Chegou!</span>
          </header>

          {/* Banner instalação */}
          <div className="bg-white border-b px-5 py-2.5 flex justify-between items-center">
            <span className="text-[10px] font-bold text-gray-500 uppercase">App Instalável</span>
            <button 
              onClick={instalarApp}
              className="bg-gray-900 text-white text-[9px] font-bold px-4 py-1.5 rounded-full active:scale-95 transition-transform"
            >
              INSTALAR
            </button>
          </div>

          {/* Filtro de categorias */}
          <div className="relative">
            <div ref={catRef} onScroll={checkScroll} className="sticky top-0 bg-gray-50 py-3 overflow-x-auto flex px-4 gap-3 no-scrollbar z-50">
              <button onClick={() => setFiltro(null)} className={`px-4 py-2 rounded-full text-xs font-bold ${!filtro ? 'bg-red-600 text-white' : 'bg-white border text-gray-400'}`}>TODOS</button>
              {categorias.map(cat => (
                <button key={cat} onClick={() => setFiltro(cat)} className={`px-4 py-2 rounded-full text-xs font-bold ${filtro === cat ? 'bg-red-600 text-white' : 'bg-white border text-gray-400'}`}>{cat}</button>
              ))}
            </div>

            {/* Setas scroll */}
            {canScrollLeft && (
              <div onClick={() => scrollCategorias(-1)} className="arrow left-0 ml-1">
                <svg className="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" d="M15 19l-7-7 7-7"/>
                </svg>
              </div>
            )}
            {canScrollRight && (
              <div onClick={() => scrollCategorias(1)} className="arrow right-0 mr-1">
                <svg className="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" d="M9 5l7 7-7 7"/>
                </svg>
              </div>
            )}
          </div>

          {/* Lista de parceiros */}
          <main className="p-4 space-y-4 max-w-md mx-auto w-full">
            {filtrados.map(res => (
              <div 
                key={res.id} 
                onClick={() => abrirCardapio(res.url)}
                className="relative bg-white rounded-3xl shadow-md overflow-hidden cursor-pointer hover:scale-105 transition-transform"
              >
                <img src={res.img} className="h-52 w-full object-cover" alt={res.nome}/>
                {res.promo && (
                  <span className="absolute top-3 left-3 bg-red-600 text-white text-[9px] font-bold px-2 py-1 rounded-full">
                    PROMO
                  </span>
                )}
                <div className="p-4 flex justify-between items-center">
                  <h2 className="text-base font-bold uppercase">{res.nome}</h2>
                </div>
              </div>
            ))}
          </main>

          {/* Footer */}
          <footer className="text-center py-4 space-y-1 border-t border-gray-200 bg-white">
            <p className="text-gray-400 text-[8px] uppercase tracking-[2px] font-bold">MYDI DELIVERY • 2026</p>
            <a href="politica-de-privacidade.html" className="text-gray-500 text-[10px] underline">Política de Privacidade</a>
          </footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(reg => console.log("SW registrado com sucesso!", reg))
          .catch(err => console.log("Erro ao registrar SW", err));
      });
    }
  </script>
</body>
</html>
